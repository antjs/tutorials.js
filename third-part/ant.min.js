!function(t,e){"function"==typeof define&&define(e),t.Ant=e()}(this,function(){"use strict";function t(e){var n,r,a,i,s=arguments.length;e=e||{};for(var o=1;s>o;o++)if(null!==(n=arguments[o]))for(var h in n)r=e[h],a=n[h],e!==a&&"__ant__"!==h&&(g(a)?(i=Array.isArray(a)?r&&Array.isArray(r)?r:[]:r||{},e[h]=t(i,a)):e[h]=a);return e}function e(t){t&&(P=t,b=P+"if",x=P+"repeat",R=P+"model")}function n(t,e){e=e||{};var n,a=e.data||{},s=e.events||{};n=i(t),t=n.tpl,n=n.el,a=this.parse(a,e),this.tpl=t,this.el=n,this.data=a,this.isRendered=!1,this.addBinding=I,"function"==typeof e.addBinding&&(this.addBinding=_(I,e.addBinding)),this.isLazy=!!e.lazy,this.partials=e.partials||{},this.options=e,o(this);for(var h in s)this.on(h,s[h]);e.data&&(r(a,this),this.render()),this.init.apply(this,arguments)}function r(t,e){function n(t){var r;for(var i in t)r=t[i],"object"==typeof r&&"__ant__"!==i&&(Array.isArray(r)&&(r.__ant__=e,a(r,e)),n(r))}n(t)}function a(t){for(var e in D)t[e]=D[e]}function i(t){var e,n=document.createElement("div");return g(t)?(e=t,t=n.outerHTML):(n.innerHTML=t.trim(),e=n.firstChild),{el:e,tpl:t}}function s(t,e,n){t.vm.$$render(e,n),1>=n&&(t.isRendered=!0)}function o(t){var e=new l;e.$$root=e,e.$$ant=t,t.vm=e,h(t.el,e)}function h(t,e){if(8!==t.nodeType){var n,r,a=t.getAttribute(x),i=t.getAttribute(b),s=t.getAttribute(R);if(a?(e.$$getChild(a).$$addGenerator(t,e.$$getChild(a),d.TYPE_REPEAT),n=!0):i?(i=i.replace(L,""),e.$$getChild(i).$$addGenerator(t,e.$$getChild(i),d.TYPE_IF),n=!0):s&&u(t,s,e),!n){for(var i=0,o=t.attributes.length;o>i;i++)c(t.attributes[i].nodeName)||e.$$updateVM(t.attributes[i],t);for(var l=t.firstChild;l;)r=l.nextSibling,3===l.nodeType?e.$$updateVM(l,l.parentNode):h(l,e),l=r}}}function u(t,e,n){var r,a=n.$$root.$$ant,i=n.$$getChild(e),s="change",o=r="value",h=v(a.get(i.$$keyPath)),u=/\r\n/g,l=function(e,n){var a=e.$$getData(n)||"",i=t[r];i.replace&&(i=i.replace(u,"\n")),a!==i&&(t[r]=a)},p=function(){var e=t[o];e.replace&&(e=e.replace(u,"\n")),a.set(i.$$keyPath,e)};switch(t.tagName){case"INPUT":case"TEXTAREA":switch(t.type){case"checkbox":o=r="checked",t.attachEvent&&(s+=" click");break;case"radio":r="checked",t.attachEvent&&(s+=" click"),l=function(e,n){t.checked=t.value===e.$$getData(n)},h=t.checked;break;default:a.isLazy||("oninput"in t&&(s+=" input"),t.attachEvent&&(s+=" keyup propertychange cut"))}break;case"SELECT":t.multiple&&(p=function(){for(var e=[],n=0,r=t.options.length;r>n;n++)t.options[n].selected&&e.push(t.options[n].value);a.set(i.$$keyPath,e)},l=function(e,n){for(var r=e.$$getData(n),a=0,i=t.options.length;i>a;a++)t.options[a].selected=r&&-1!==r.indexOf(t.options[a].value)}),h=h&&!c(t[o])}i.$$watchers.push(l),s.split(/\s+/g).forEach(function(e){T(t,e,p),N(t,e,p)}),t.removeAttribute(R),t[o]&&h&&p()}function l(){this.$$keyPath="",this.$$watchers=[]}function c(t){return t&&S.test(t)}function p(t,e){var n,r,a,i,s=[],o=[],h=0,u=t.nodeValue;if(3===t.nodeType)r="text";else{if(2!==t.nodeType)return console.error("我们需要一个文本节点或者属性节点"),void 0;r="attr",a=t.nodeName,0===(i=a.indexOf(P))&&(a=t.nodeName.slice(P.length))}for(S.lastIndex=0;n=S.exec(u);)S.lastIndex-h>n[0].length&&o.push(u.slice(h,S.lastIndex-n[0].length)),s.push({escape:!n[2],path:(n[2]||n[1]).trim(),position:o.length}),o.push(n[0]),h=S.lastIndex;return u.length>h&&o.push(u.slice(h,u.length)),{tokens:s,textMap:o,node:t,type:r,refNodeName:a,el:e}}function f(t,e,n){var r=e.position,a=n.node,i=n.textMap,s=n.refNodeName;if(t+""!=i[r]+""){if(a.nodeValue!==i.join("")&&e.escape)return console.warn("没有更新内容. 因为模板内容已被其他程序修改!"),void 0;if(i[r]=t&&t+"",e.escape||"text"!==n.type)a.nodeValue=i.join(""),s&&"attr"===n.type&&("style"===s&&n.el.style.setAttribute?n.el.style.setAttribute("cssText",a.nodeValue):n.el.setAttribute(n.refNodeName,a.nodeValue));else{var o,h=document.createElement("div");e.unescapeNodes=e.unescapeNodes||[],h.innerHTML=i.join(""),o=h.childNodes,e.unescapeNodes.forEach(function(t){t.parentNode.removeChild(t)}),e.unescapeNodes=[];for(var u=0,l=o.length;l>u;u++)e.unescapeNodes.push(o[u]),a.parentNode.insertBefore(o[u],a),u--,l--;a.nodeValue=""}}}function d(t,e,n){for(var r,a=t,i=n===d.TYPE_IF?b:x;;){if(a=a.nextSibling,a&&a.hasAttributes){if(d.isGenTempl(a))continue;r="sibling";break}a=t.parentNode,r="parent";break}this.path=t.getAttribute(i),t.removeAttribute(i),i===b&&h(t,e.$$parent),this.el=t,this.vm=e,this.type=n,this.relateEl=a,this.relateType=r,this.instances=[],this.state=this.STATE_READY,t.parentNode&&t.parentNode.removeChild(t)}function $(){}function g(t){return"object"==typeof t&&null!==t}function v(t){return"undefined"==typeof t}function y(t,e,n){return function(){var r=e.apply(this,arguments);return n&&n.call(this,r)?r:t.apply(this,arguments)}}function E(t,e,n){return function(){var r=t.apply(this,arguments);return n&&n.call(this,r)?r:(e.apply(this,arguments),r)}}function _(t,e){return y(t,e,function(t){return t===!1})}function m(t,e,n){var r=t.replace(V,"").split(j),a=n;return r.forEach(function(t,n){n===r.length-1?a[t]=e:a&&a.hasOwnProperty(t)?a=a[t]:(a[t]=r[n+1]&&/^\d+$/.test(r[n+1])?[]:{},a=a[t])}),n}function A(t,e){for(var n,r=t.replace(V,"").split(j),a=e,i=0,s=r.length;s>i;i++){if(n=r[i],!a||!a.hasOwnProperty(n))return;a=a[n]}return a}function N(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)}function T(t,e,n){t.removeEventListener?t.removeEventListener(e,n):t.detachEvent("on"+e,n)}var P,b,x,R,k={on:function(t,e,n){var r=n||this;return r._handlers=r._handlers||{},r._handlers[t]=r._handlers[t]||[],r._handlers[t].push({handler:e,context:n,ctx:r}),this},off:function(t,e,n){var r=n||this,a=r._handlers;if(t&&a[t])if("function"==typeof e)for(var i=0;i<a[t].length;i++)a[t][i].handler===e&&(a[t].splice(i,1),i--);else a[t]=[];return this},trigger:function(t){var e=this,n=[].slice.call(arguments,1),r=e._handlers;return r&&r[t]&&r[t].forEach(function(t){t.handler.apply(e,n)}),this}},C={extend:function(e,n){var r=this,a=function(){return r.apply(this,arguments)},i=function(){this.constructor=a};return i.prototype=r.prototype,a.prototype=new i,t(a.prototype,e),t(a,r,n),a}},w={RENDER:0,RESET:1,EXTEND:2,ARRAY_REPLACE:3};e("a-"),t(n,C,{RENDER_TYPE:w,setPrefix:e,Event:k}),t(n.prototype,k,{update:function(t,e,n){var r;g(t)?(n=e,e=t):"string"==typeof t&&v(e)&&(e=m(t,r=this.get(t),{}),n=Array.isArray(r)?w.ARRAY_REPLACE:w.EXTEND),v(n)&&(n=w.EXTEND),s(this,e||this.data,n),this.trigger("update",e)},render:function(t){s(this,t||this.data,w.RENDER),this.trigger("render")},reset:function(t){this.set(t,{type:w.RESET}),this.trigger("reset")},clone:function(e){return new this.constructor(this.tpl,t(this.options,e))},get:function(t){return A(t,this.data)},set:function(e,n,a){var i,s,o,h={};if(!e)return this;if(g(e)){a=n,a=a||{},h=this.parse(e,a),e="";for(var u in h)this.data[u]!==h[u]&&(this.data[u]=h[u],a.silence||(i=!0,o=a.type))}else a=a||{},s=A(e,this.data),m(e,n,h),n=A(e,h),h=this.parse(h,a),a.silence||s===n||(t(this.data,h),i=!0,o=v(a.type)?Array.isArray(s)?w.ARRAY_REPLACE:w.EXTEND:opts.type);r(h,this),i&&this.update(h,o)},_virtual:function(){},parse:function(t){return t},init:$});var D={splice:E([].splice,function(){this.__ant__.update(null,null,3)}),push:E([].push,function(){this.__ant__.update(null,null,3)}),pop:E([].pop,function(){this.__ant__.update(null,null,3)}),sort:E([].sort,function(){this.__ant__.update(null,null,3)}),reverse:E([].reverse,function(){this.__ant__.update(null,null,3)}),unshift:E([].unshift,function(){this.__ant__.update(null,null,3)}),shift:E([].shift,function(){this.__ant__.update(null,null,3)})};l.prototype={$$watchers:null,$$root:null,$$parent:null,$$generators:null,$$ant:null,$$data:null,$$keyPath:null,$$updateVM:function(t,e){c(t.nodeValue)&&this.$$addWatcher(t,e)},$$getChild:function(t){var e,n,r,a=this;r=t.split(/(?!^)\.(?!$)/);for(var i=0,s=r.length;s>i;i++)e=r[i],a[e]||(n=new l,n.$$parent=a,n.$$root=a.$$root||a,n.$$keyPath=a.$$keyPath+(a.$$keyPath&&".")+e,a[e]=n),a=a[e];return a},$$addWatcher:function(t,e){var n=p(t,e),r=n.tokens,a=n.textMap,i=this;"text"===n.type&&a.length>1?(a.forEach(function(n){var r=document.createTextNode(n);e.insertBefore(r,t),i.$$updateVM(r,e)}),e.removeChild(t)):r.forEach(function(t){I(n,i,t)})},$$addGenerator:function(t,e,n){this.$$generators=this.$$generators||[];var r=new d(t,e,n);return this.$$generators.push(r),r},$$getData:function(t,e){if(e)return this.$$data[t];for(var n=this;n;n=n.$$parent)if(n.$$data&&!v(n.$$data[t]))return n.$$data[t]},$$render:function(t,e){var n,r=this;r.$$data=t;for(var a in r)if(!(!r.hasOwnProperty(a)||a in l.prototype||e>=w.EXTEND&&g(t)&&!(a in t))){if(n=r.$$getChild(a),n.$$generators&&n.$$generators.length)for(var i=0,s=n.$$generators.length;s>i;i++)(n.$$generators[i].type==d.TYPE_IF||0===n.$$generators[i].state||e!==w.EXTEND)&&n.$$generators[i].generate(t,a);if(r[a].$$watchers.length)for(var i=0,s=n.$$watchers.length;s>i;i++)n.$$watchers[i](r,a);(!v(t[a])||e<w.EXTEND)&&n.$$render(v(t[a])?{}:t[a],e)}}};var S=/{{({([^{}\n]+)}|[^{}\n]+)}}/g,I=function(t,e,n){var r=e.$$getChild(n.path);r.$$watchers.push(function(e,r){var a="."===r?e.$$data:e.$$getData(r);f(a,n,t)})},L=/^\^/;I=_(I,function(t,e,n){var r=n.path,a=r.split(":");if(2===a.length){var i=a[0].trim(),s=a[1].trim();return e.$$getChild(i.replace(L,"")).$$watchers.push(function(e,r){var a=e.$$getData(r),o=(L.test(i)?!a:a)?s:"";f(o,n,t)}),!1}});var Y=/^>\s*(?=.+)/;I=_(I,function(t,e,r){var a,s,o,u;return"text"===t.type&&Y.test(r.path)?(a=r.path.replace(Y,""),o=e.$$root.$$ant,(s=o.partials[a])&&(u=s instanceof n?s.el:i(s).el,h(u,e),t.node.parentNode.insertBefore(u,t.node)),!1):void 0}),t(d,{TYPE_REPEAT:"repeat",TYPE_IF:"if",isGenTempl:function(t){return t&&t.hasAttributes&&t.hasAttributes(x)||t.hasAttributes(b)}}),d.prototype={STATE_READY:0,STATE_GENEND:1,generate:function(t,e){var n=this,r=document.createDocumentFragment(),a=t[e];if(n.type===d.TYPE_REPEAT){if(a&&!Array.isArray(a))return console.warn(JSON.stringify(a)+" 应该是一个数组"),void 0;n.empty(),a&&a.forEach(function(t,e){var a=n.el.cloneNode(!0),i=n.vm.$$getChild(e+"");r.appendChild(a),h(a,i),i.$$render(t),n.instances.push(a)})}else L.test(this.path)&&(a=!a),a?n.lastIfState||r.appendChild(n.el):n.lastIfState&&n.el.parentNode.removeChild(n.el),n.lastIfState=a;"sibling"===n.relateType?n.relateEl.parentNode.insertBefore(r,n.relateEl):n.relateEl.appendChild(r),n.state=this.STATE_GENEND},splice:function(){},empty:function(){var t=this;this.instances.forEach(function(e,n){e.parentNode&&11!==e.parentNode.nodeType&&e.parentNode.removeChild(e),delete t.vm[n]}),this.instances=[]}};var j=/(?:\.|\[)/g,V=/\]/g;return n}),function(t,e){var n=e(t),r=function(t){var r={},a=function(){var t,e,n=o.queryParse(location.hash),a=n.params=[];for(var i in r)if(e=r[i],t=e.reg.exec(n.path)){for(var s=1,h=t.length;h>s;s++){var u=e.keys[s-1],l=decodeURIComponent(t[s]);u?a[u.name]=l:a.push(l)}this.trigger(i,n)}},i=e.extend({},t,{on:function(e,n){if(!r[e]){var a=[];r[e]={reg:s(e,a,!0,!0),keys:a}}return t.on.call(this,e,n),this},off:function(e){return t.off.apply(this,arguments),this._handlers[e]&&this._handlers[e].length||delete r[e],this},navigate:function(t){return location.hash=t,this},route:function(t){for(var e in t)this.on(e,t[e]);return this},start:function(t){this.stop();var e=a.bind(this);return n.on("hashchange",e),a.guid=e.guid,this.route(t),n.trigger("hashchange"),this},stop:function(){return n.off("hashchange",a),this}}),s=function(t,e,n,r){return"[object RegExp]"=={}.toString.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,r,a,i,s,o){return e.push({name:a,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(r||"")+(i||r&&"([^/.]+?)"||"([^/]+?)")+")"+(s||"")+(o?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))},o=function(){var t=function(e,n){e=e||location.href;for(var r=/(?:(\w+\:)\/\/)?([^\/]+)?(\/[^?#]*)?(\?[^#]*)?(#.*)?/,a=e.match(r),i={},s=["href","protocal","host","pathname","search","hash"],o=0,h=s.length;h>o;o++)i[s[o]]=a[o]||"";return i.hostname=i.host,i.pathname=i.pathname||"/",i.paths=t.pathParse(i.pathname),n&&(i.searchobj=t.queryParse(i.search),i.hashobj=t.queryParse(i.hash)),i};return t.queryParse=function(){var e=/#?([^?]*)(\?.*)?$/,n=function(n){var r,a,i=n.match(e),s={};if(s.path=i[1],s.search=i[2],s.paths=i[1]&&t.pathParse(i[1]),s.search){r=s.search.slice(1).split("&"),a={};for(var o=0;o<r.length;o++){var h=r[o].split("=");a[h[0]]=h[1]}s.searchObj=a}return s};return n}(),t.pathParse=function(t){return t.replace(/(^\/|\/$)/,"").split("/")},t}();return i}(Ant.Event);t.Ant.setPrefix("z-"),t.Ant=t.Ant.extend({fetch:function(t){return t.url=t.url||this.url,e.ajax(t)},on:function(t,n){n=n||function(){};var r=n.bind(this),a=t.trim().split(/\s+/);return a.push(r),e(this.el).on.apply(e(this.el),a),n.guid=r.guid,this},trigger:function(){var t=[].slice.call(arguments),n=t.shift().trim().split(/\s+/);return t.unshift(n[0]),e(this.el).trigger.apply(e(this.el),t),this},off:function(t,n){var r=t.trim().split(/\s+/);return r.push(n),e(this.el).off.apply(e(this.el),r),this}},{router:r})}(this,jQuery);